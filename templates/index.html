<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’•æˆ‘ä»¬çš„åœ°ç›˜ï¼</title>
    
    <!-- Leaflet åœ°å›¾åº“ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- è‡ªå®šä¹‰æ ·å¼ï¼ˆå¦‚æœæ²¡æœ‰å•ç‹¬çš„ style.css æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å†…è”æ ·å¼ï¼‰ -->
    <link rel="stylesheet" href="/static/css/style.css">
    
    <!-- å†…è”æ ·å¼è¡¥å……ï¼ˆç¡®ä¿æ‰€æœ‰æ ·å¼éƒ½æœ‰ï¼‰ -->
    <style>
        /* ========================================
           ç”¨æˆ·å¡ç‰‡æ ·å¼
           ======================================== */
        .user-card-container {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .avatar-container {
            animation: float 3s ease-in-out infinite;
            cursor: pointer;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .avatar-frame {
            width: 180px;
            height: 220px;
            border-radius: 50%;
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            padding: 4px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            position: relative;
            transition: transform 0.3s ease;
        }

        .avatar-frame:hover {
            transform: scale(1.1);
        }

        .avatar-frame::before,
        .avatar-frame::after {
            content: 'â¤ï¸';
            position: absolute;
            font-size: 16px;
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        .avatar-frame::before {
            top: -10px;
            left: -5px;
            animation-delay: 0.2s;
        }

        .avatar-frame::after {
            top: -10px;
            right: -5px;
            animation-delay: 0.4s;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            background: white;
        }

        .avatar-frame-img {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 2;
            pointer-events: none;
        }

        .user-info-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            opacity: 0;
            transform: translateX(-20px);
            transition: all 0.3s ease;
            display: none;
        }

        .user-name {
            font-size: 18px;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 5px;
        }

        .user-id {
            font-size: 12px;
            color: #999;
            margin-bottom: 10px;
        }

        .user-stats {
            display: flex;
            gap: 15px;
        }

        .user-stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .user-stat-icon {
            font-size: 16px;
        }

        .user-stat-number {
            font-weight: bold;
            color: #764ba2;
        }

        /* ========================================
           åœ°ç‚¹åˆ—è¡¨æ¨¡æ€æ¡†
           ======================================== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 5000;
            display: none;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -60%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .modal-header {
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 20px;
        }

        .modal-close {
            font-size: 28px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .modal-close:hover {
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 20px;
            max-height: calc(80vh - 80px);
            overflow-y: auto;
        }

        .places-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .place-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .place-item:hover {
            background: white;
            border-color: #f093fb;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(240, 147, 251, 0.2);
        }

        .place-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .place-item h4 {
            margin: 0;
            color: #764ba2;
            font-size: 16px;
        }

        .place-rating {
            font-size: 14px;
        }

        .place-note {
            color: #666;
            font-size: 14px;
            margin: 10px 0;
            line-height: 1.4;
        }

        .place-meta {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #999;
            margin-bottom: 10px;
        }

        .place-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .mini-btn {
            padding: 5px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            background: #f093fb;
            color: white;
            transition: opacity 0.3s ease;
        }

        .mini-btn:hover {
            opacity: 0.8;
        }

        .mini-btn.danger {
            background: #dc3545;
        }

        /* ========================================
           å¿«é€ŸæŸ¥çœ‹æŒ‰é’®
           ======================================== */
        .quick-view-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .view-btn {
            flex: 1;
            padding: 10px;
            background: white;
            border: 2px solid #f093fb;
            border-radius: 10px;
            color: #764ba2;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .view-btn:hover {
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            color: white;
            transform: translateY(-2px);
        }

        /* è‡ªå®šä¹‰å›¾æ ‡æ ·å¼ */
        .mode-icon {
            width: 20px;
            height: 20px;
            vertical-align: middle;
            margin-right: 5px;
        }

        .marker-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .marker-icon {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .emoji-icon {
            font-size: 24px;
        }

        .search-container input:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 10px rgba(240, 147, 251, 0.3);
        }

        .search-container button:hover {
            transform: scale(1.05);
        }

        /* æœç´¢å»ºè®®é¡¹æ‚¬åœæ•ˆæœ */
        #searchSuggestions > div:hover {
            background: #f8f9fa;
        }

        #searchSuggestions > div:last-child {
            border-bottom: none !important;
        }
    </style>
</head>
<body>
    <!-- åœ°å›¾å®¹å™¨ -->
    <div id="map" style="height: 100vh; width: 100vw;"></div>

    <!-- ç”¨æˆ·å¡ç‰‡å®¹å™¨ -->
    <div class="user-card-container">
        <!-- å¤´åƒå®¹å™¨ -->
        <div class="avatar-container" onclick="toggleUserInfo()">
            <div class="avatar-frame" style="width: 150px; height: 200px;">
                <!-- ç»™å¤´åƒæ¡†å›¾ç‰‡åŠ ä¸Š style -->
                <img src="/static/images/avatar-frame.png" alt="å¤´åƒæ¡†" 
                    style="position: absolute; width: 140%; height: 140%; top: -20%; left: -22%; z-index: 2; pointer-events: none;"
                    onerror="this.style.display='none'">
                
                <!-- å¤´åƒä¹Ÿè¦ç¡®ä¿å¡«æ»¡å®¹å™¨ -->
                <img src="/static/images/avatar.png" alt="å¤´åƒ" 
                    style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;"
                    onerror="this.src='/static/images/avatar-default.png'">
            </div>
        </div>
        
        <!-- ç”¨æˆ·ä¿¡æ¯é¢æ¿ -->
        <div class="user-info-panel" id="userInfoPanel">
            <div class="user-name">åˆ˜ç­‰ç­‰</div>
            <div class="user-id">ID: 339233</div>
            <div class="user-stats">
                <div class="user-stat-item">
                    <span class="user-stat-icon">
                        <img src="/static/images/heart-user-icon.png" 
                            style="width: 30px; height: 30px; vertical-align: middle;" 
                            onerror="this.style.display='none'; this.parentElement.textContent='â¤ï¸'">
                    </span>
                    <span class="user-stat-number" id="userHeartCount">0</span>
                </div>
                <div class="user-stat-item">
                    <span class="user-stat-icon">
                        <img src="/static/images/paw-user-icon.png" 
                            style="width: 30px; height: 30px; vertical-align: middle;" 
                            onerror="this.style.display='none'; this.parentElement.textContent='ğŸ¾'">
                    </span>
                    <span class="user-stat-number" id="userPawCount">0</span>
                </div>
            </div>
            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee;">
                <div style="font-size: 12px; color: #666;">
                    åŠ å…¥æ—¶é—´: 2024.10.03<br>
                    æ¢åº—ç­‰çº§: ç”œæŸ±ğŸ¬
                </div>
            </div>
        </div>
    </div>

    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="control-panel" style="position: absolute; top: 20px; right: 20px; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 20px; padding: 20px; box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37); z-index: 1000; max-width: 300px;">
        <h3 style="color: #764ba2; margin-bottom: 15px; font-size: 18px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 5px;">
            æ¢åº—åœ°å›¾
            <img src="/static/images/title-heart-icon.png" 
                style="width: 40px; height: 40px;" 
                onerror="this.style.display='none'; this.parentElement.innerHTML += 'â£ï¸'">
        </h3>
       
        <!-- åœ°å€æœç´¢æ¡† -->
        <div class="search-container" style="margin-bottom: 15px;">
            <div style="display: flex; gap: 5px;">
                <input type="text" 
                    id="addressSearch" 
                    placeholder="æœç´¢åœ°å€ (å¦‚: 360 Huntington Ave)" 
                    style="flex: 1; padding: 10px; border: 2px solid #f093fb; border-radius: 10px; font-size: 14px;"
                    onkeypress="if(event.key==='Enter') searchAddress()">
                <button onclick="searchAddress()" 
                        style="padding: 10px 15px; background: linear-gradient(45deg, #f093fb, #f5576c); color: white; border: none; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                    <img src="/static/images/search-icon.png" 
                        style="width: 20px; height: 20px;" 
                        onerror="this.style.display='none'; this.parentElement.innerHTML='ğŸ”'">
                </button>
            </div>


        <!-- æˆ–è€…ç”¨æŒ‰é’®ç»„çš„æ–¹å¼ -->
        <div class="quick-jump-buttons" style="margin-bottom: 15px;">
            <div style="font-size: 8px; color: #666; margin-bottom: 8px;"></div>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px;">
                <button onclick="jumpToLocation('æ³¢å£«é¡¿')" class="jump-btn">æ³¢å£«é¡¿</button>
                <button onclick="jumpToLocation('åŒ—äº¬')" class="jump-btn">åŒ—äº¬</button>
                <button onclick="jumpToLocation('ä¸Šæµ·')" class="jump-btn">ä¸Šæµ·</button>
                <button onclick="jumpToLocation('å¹¿å·')" class="jump-btn">å¹¿å·</button>
                <button onclick="jumpToLocation('æˆéƒ½')" class="jump-btn">æˆéƒ½</button>
                <button onclick="jumpToLocation('äºšç‰¹å…°å¤§')" class="jump-btn">äºšç‰¹å…°å¤§</button>
            </div>
        </div>

            <!-- æœç´¢å»ºè®®åˆ—è¡¨ -->
            <div id="searchSuggestions" style="display: none; margin-top: 5px; background: white; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-height: 200px; overflow-y: auto;">
            </div>
        </div>



    <!-- æ¨¡å¼é€‰æ‹©å™¨ -->
    <div class="mode-selector" style="display: flex; gap: 10px; margin-bottom: 15px;">
        <!-- æŸ¥çœ‹æŒ‰é’® -->
        <button class="mode-btn active" id="mode-view" onclick="setMode('view')" 
                style="flex: 1; padding: 10px; border: 2px solid #f093fb; background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%); color: white; border-radius: 10px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;">
            <img src="/static/images/view-icon.png" class="mode-icon" 
                onerror="this.style.display='none'; this.parentElement.innerHTML='ğŸ‘€ æŸ¥çœ‹'"
                style="width: 30px; height: 30px; margin-right: 5px;">
            <span>æŸ¥çœ‹</span>
        </button>
        
        <!-- æƒ³å»æŒ‰é’® -->
        <button class="mode-btn" id="mode-heart" onclick="setMode('heart')"
                style="flex: 1; padding: 10px; border: 2px solid #f093fb; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;">
            <img src="/static/images/heart-icon.png" class="mode-icon" 
                onerror="this.style.display='none'; this.parentElement.innerHTML='â¤ï¸ æƒ³å»'"
                style="width: 30px; height: 30px; margin-right: 5px;">
            <span>æƒ³å»</span>
        </button>
        
        <!-- å»è¿‡æŒ‰é’® -->
        <button class="mode-btn" id="mode-paw" onclick="setMode('paw')"
                style="flex: 1; padding: 10px; border: 2px solid #f093fb; background: white; border-radius: 10px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;">
            <img src="/static/images/paw-icon.png" class="mode-icon" 
                onerror="this.style.display='none'; this.parentElement.innerHTML='ğŸ¾ å»è¿‡'"
                style="width: 30px; height: 30px; margin-right: 5px;">
            <span>å»è¿‡</span>
        </button>
    </div>
        
        <!-- åœ¨æ§åˆ¶é¢æ¿ä¸­æ·»åŠ  -->
        <div style="margin-top: 15px; margin-bottom: 15px;">
            <label style="font-size: 12px; color: #666; display: block; margin-bottom: 5px;">ç­›é€‰ç±»å‹ï¼š</label>
            <select id="filterCategory" onchange="filterMarkers(this.value)" 
                    style="width: 100%; padding: 10px; border: 2px solid #f093fb; border-radius: 10px; background: white; cursor: pointer;">
                <option value="all">ğŸŒŸ æ˜¾ç¤ºå…¨éƒ¨</option>
                <option value="chinese">ğŸ¥Ÿ åªçœ‹ä¸­é¤</option>
                <option value="western">ğŸ” åªçœ‹è¥¿é¤</option>
                <option value="japanese">ğŸ± åªçœ‹æ—¥æ–™</option>
                <option value="korean">ğŸ¥˜ åªçœ‹éŸ©é¤</option>
                <option value="cafe">â˜• åªçœ‹å’–å•¡åº—</option>
                <option value="dessert">ğŸ° åªçœ‹ç”œå“</option>
                <option value="hotpot">ğŸ² åªçœ‹ç«é”…</option>
                <option value="bbq">ğŸ– åªçœ‹çƒ§çƒ¤</option>
                <option value="tea">ğŸµ åªçœ‹èŒ¶é¥®</option>
                <option value="bar">ğŸº åªçœ‹é…’å§</option>
                <option value="other">ğŸ“ åªçœ‹å…¶ä»–</option>
            </select>
        </div>

        <!-- å¿«é€ŸæŸ¥çœ‹æŒ‰é’® -->
        <div class="quick-view-buttons">
            <button class="view-btn" onclick="showPlacesList('heart')" 
                    style="display: flex; align-items: center; justify-content: center; gap: 5px;">
                <img src="/static/images/list-icon1.png" 
                    style="width: 30px; height: 30px;" 
                    onerror="this.style.display='none'; this.parentElement.insertAdjacentHTML('afterbegin', 'ğŸ“‹ ')">
                æƒ³å»
                <img src="/static/images/heart-small-icon.png" 
                    style="width: 16px; height: 16px;" 
                    onerror="this.style.display='none'; this.parentElement.insertAdjacentHTML('beforeend', 'ï¸')">
                åˆ—è¡¨
            </button>
            <button class="view-btn" onclick="showPlacesList('paw')" 
                    style="display: flex; align-items: center; justify-content: center; gap: 5px;">
                <img src="/static/images/list-icon2.png" 
                    style="width: 30px; height: 30px;" 
                    onerror="this.style.display='none'; this.parentElement.insertAdjacentHTML('afterbegin', 'ğŸ“‹ ')">
                å»è¿‡
                <img src="/static/images/paw-small-icon.png" 
                    style="width: 16px; height: 16px;" 
                    onerror="this.style.display='none'; this.parentElement.insertAdjacentHTML('beforeend', 'ï¸')">
                åˆ—è¡¨
            </button>
        </div>
        
        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="stats" style="display: flex; justify-content: space-around; margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
            <div class="stat-item" style="text-align: center;">
                <div class="stat-number" id="heartCount" style="font-size: 24px; font-weight: bold; color: #764ba2;">0</div>
                <div class="stat-label" style="font-size: 12px; color: #666; display: flex; align-items: center; justify-content: center; gap: 3px; margin-top: 5px;">
                    <img src="/static/images/heart-stat-icon.png" 
                        style="width: 14px; height: 14px;" 
                        onerror="this.style.display='none'; this.parentElement.insertAdjacentHTML('afterbegin', 'â¤ï¸ ')">
                    æƒ³å»çš„åœ°æ–¹
                </div>
            </div>
            <div class="stat-item" style="text-align: center;">
                <div class="stat-number" id="pawCount" style="font-size: 24px; font-weight: bold; color: #764ba2;">0</div>
                <div class="stat-label" style="font-size: 12px; color: #666; display: flex; align-items: center; justify-content: center; gap: 3px; margin-top: 5px;">
                    <img src="/static/images/paw-stat-icon.png" 
                        style="width: 14px; height: 14px;" 
                        onerror="this.style.display='none'; this.parentElement.insertAdjacentHTML('afterbegin', 'ğŸ¾ ')">
                    å»è¿‡çš„åœ°æ–¹
                </div>
            </div>
        </div>
        
        <!-- è¿›åº¦æ¡ -->
        <div style="margin-top: 15px;">
            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">
                è·ç¦»å®Œæˆ...!: <span id="completionRate">0</span>%
            </div>
            <div style="background: #e0e0e0; height: 8px; border-radius: 4px; overflow: hidden;">
                <div id="progressBar" style="background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%); 
                     height: 100%; width: 0%; transition: width 0.5s ease;"></div>
            </div>
        </div>

        <!-- é¢å¤–åŠŸèƒ½æŒ‰é’® -->
        <div style="margin-top: 15px; display: flex; gap: 10px;">
            <button onclick="exportBackup()" style="flex: 1; padding: 8px; background: #4facfe; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center; gap: 5px;">
                <img src="/static/images/export-icon.png" 
                    style="width: 25px; height: 25px;" 
                    onerror="this.style.display='none'; this.parentElement.insertAdjacentHTML('afterbegin', 'ğŸ’¾ ')">
                å¤‡ä»½
            </button>
            <button onclick="showImportDialog()" style="flex: 1; padding: 8px; background: #00f2fe; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center; gap: 5px;">
                <img src="/static/images/import-icon.png" 
                    style="width: 25px; height: 25px;" 
                    onerror="this.style.display='none'; this.parentElement.insertAdjacentHTML('afterbegin', 'ğŸ“‚ ')">
                æ¢å¤
            </button>
        </div>

        <!-- æ·»åŠ éšè—çš„æ–‡ä»¶è¾“å…¥ -->
        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importBackup(this)">
    </div>

    <!-- åœ°ç‚¹åˆ—è¡¨å¼¹çª— -->
    <div id="placesListModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">åœ°ç‚¹åˆ—è¡¨</h2>
                <span class="modal-close" onclick="closePlacesList()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="placesList" class="places-list"></div>
            </div>
        </div>
    </div>

    <!-- éŸ³ä¹æ§åˆ¶ -->
    <div class="music-control" style="position: absolute; bottom: 20px; left: 20px; z-index: 1000;">
        <button class="music-btn" onclick="toggleMusic()" id="musicBtn" 
                style="width: 50px; height: 50px; border-radius: 50%; background: rgba(255, 255, 255, 0.9); border: none; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); padding: 0; display: flex; align-items: center; justify-content: center;">
            <img src="/static/images/music-off.png" 
                id="musicIcon"
                style="width: 30px; height: 30px;" 
                onerror="this.style.display='none'; this.parentElement.innerHTML='ğŸµ'">
        </button>
    </div>

    <!-- æ—¶é—´è½´ -->
    <div class="timeline" id="timeline" style="position: absolute; bottom: 20px; right: 20px; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 15px; padding: 15px; z-index: 1000; max-width: 250px; max-height: 200px; overflow-y: auto;">
        <h4 style="margin-bottom: 10px; color: #764ba2; display: flex; align-items: center; gap: 5px;">
            <img src="/static/images/calendar-icon.png" 
                style="width: 20px; height: 20px;" 
                onerror="this.style.display='none'; this.parentElement.insertBefore(document.createTextNode('ğŸ“… '), this.parentElement.firstChild)">
            æœ€è¿‘æ ‡è®°
        </h4>
        <div id="timelineContent">
            <div style="color: #999; font-size: 12px;">æš‚æ— æ ‡è®°</div>
        </div>
    </div>

    <!-- æˆå°±æç¤ºï¼ˆé»˜è®¤éšè—ï¼‰ -->
    <div id="achievementPopup" class="achievement-popup" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 20px; text-align: center; z-index: 4000; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);">
        <div class="achievement-icon" style="font-size: 48px; margin-bottom: 10px;">ğŸ†</div>
        <div class="achievement-title" style="font-size: 24px; color: #764ba2; margin-bottom: 10px;">è·å¾—æˆå°±ï¼</div>
        <div class="achievement-description" id="achievementDesc" style="color: #666;">é¦–æ¬¡æ ‡è®°åœ°ç‚¹</div>
    </div>

    <!-- åŠ è½½æç¤º -->
    <div id="loadingTip" class="loading-tip" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255, 255, 255, 0.95); padding: 20px 40px; border-radius: 15px; z-index: 2000; text-align: center; box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);">
        <div>åŠ è½½ä¸­...</div>
    </div>

    <!-- éŸ³é¢‘æ–‡ä»¶ -->
    <audio id="bgMusic" loop>
        <source src="/static/audio/background-music.mp3" type="audio/mpeg">
    </audio>
    <audio id="clickSound">
        <source src="/static/audio/click-sound.mp3" type="audio/mpeg">
    </audio>

    <!-- Leaflet åœ°å›¾åº“ -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- ä¸»è¦ JavaScript æ–‡ä»¶ -->
    <script src="/static/js/main.js"></script>
    
    <!-- é¡µé¢åˆå§‹åŒ–å’Œè¾…åŠ©åŠŸèƒ½ -->
    <script>
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', function() {
            // æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
            showWelcomeMessage();
            
            // åˆå§‹åŒ–åœ°å›¾
            initMap();
            
            // åŠ è½½æ•°æ®
            loadPlaces();
            
            // æ£€æŸ¥æˆå°±
            checkFirstTimeUser();
            
            // è‡ªåŠ¨æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼ˆæ–°å¢ï¼‰
            setTimeout(() => {
                const music = document.getElementById('bgMusic');
                if (music) {
                    music.volume = 0.3; // è®¾ç½®éŸ³é‡ï¼ˆ0.0 åˆ° 1.0ï¼‰
                    music.play().catch(e => {
                        console.log('è‡ªåŠ¨æ’­æ”¾è¢«æµè§ˆå™¨é˜»æ­¢');
                    });
                }
            }, 1000);
        });
        
        // æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
        function showWelcomeMessage() {
            const welcome = document.createElement('div');
            welcome.className = 'loading-tip';
            welcome.style.cssText = 'display: block; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 20px; z-index: 2000; text-align: center; box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);';
            welcome.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <img src="/static/images/welcome-icon.png" 
                        style="width: 80px; height: 80px;" 
                        onerror="this.parentElement.innerHTML='ğŸ’•'; this.parentElement.style.fontSize='48px';">
                </div>
                <div style="font-size: 20px; font-weight: bold; color: #764ba2; margin-bottom: 10px;">
                    æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„æ¢åº—åœ°å›¾å“‡ï¼
                </div>
                <div style="font-size: 14px; color: #666;">
                    â€œæˆ‘è¦åƒç”œçš„ï¼â€
                </div>
                <div style="margin-top: 15px; font-size: 12px; color: #999;">
                    ç‚¹å‡»åœ°å›¾å¼€å§‹æ ‡è®°ä½ æ»´ç›®æ ‡
                </div>
            `;
            document.body.appendChild(welcome);
            
            setTimeout(() => {
                welcome.style.opacity = '0';
                welcome.style.transition = 'opacity 0.5s ease';
                setTimeout(() => welcome.remove(), 500);
            }, 3000);
        }
        
        // åˆ‡æ¢ç”¨æˆ·ä¿¡æ¯é¢æ¿
        function toggleUserInfo() {
            const panel = document.getElementById('userInfoPanel');
            if (panel.style.display === 'none' || !panel.style.display) {
                panel.style.display = 'block';
                setTimeout(() => {
                    panel.style.opacity = '1';
                    panel.style.transform = 'translateX(0)';
                }, 10);
            } else {
                panel.style.opacity = '0';
                panel.style.transform = 'translateX(-20px)';
                setTimeout(() => {
                    panel.style.display = 'none';
                }, 300);
            }
        }
        
        // æ£€æŸ¥æ˜¯å¦é¦–æ¬¡ä½¿ç”¨
        function checkFirstTimeUser() {
            if (!localStorage.getItem('hasVisited')) {
                localStorage.setItem('hasVisited', 'true');
                setTimeout(() => {
                    // ä½¿ç”¨è‡ªå®šä¹‰å›¾ç‰‡
                    showAchievement('æ¬¢è¿ï¼', 'ç¾é£Ÿå†’é™©æˆ‘æ¥è¾£', '/static/images/welcome-achievement-icon.png');
                }, 4000);
            }
        }
        
        // å¯¼å‡ºæ•°æ®åŠŸèƒ½
        function exportData() {
            const data = localStorage.getItem('mapPlaces') || '[]';
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `love-map-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            showNotification('ğŸ“¥ æ•°æ®å·²å¯¼å‡º', 'success');
        }
        
        // åˆ†äº«åœ°å›¾åŠŸèƒ½
        function shareMap() {
            const shareUrl = window.location.href;
            if (navigator.share) {
                navigator.share({
                    title: 'æ¢åº—åœ°å›¾â£ï¸',
                    text: 'æ¥çœ‹çœ‹æˆ‘ä»¬çš„æ¢åº—è®°å½•å§ï¼',
                    url: shareUrl
                });
            } else {
                // å¤åˆ¶åˆ°å‰ªè´´æ¿
                navigator.clipboard.writeText(shareUrl);
                showNotification('ğŸ”— é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            }
        }
        
        // æ˜¾ç¤ºæˆå°±æç¤º
        function showAchievement(title, description, iconParam) {
            const popup = document.getElementById('achievementPopup');
            if (popup) {
                const iconElement = popup.querySelector('.achievement-icon');
                
                // åˆ¤æ–­ä¼ å…¥çš„æ˜¯å›¾ç‰‡è·¯å¾„è¿˜æ˜¯emoji
                if (iconParam && (iconParam.includes('.png') || iconParam.includes('.jpg') || iconParam.includes('/'))) {
                    // æ˜¯å›¾ç‰‡è·¯å¾„ï¼Œåˆ›å»ºimgæ ‡ç­¾
                    iconElement.innerHTML = `<img src="${iconParam}" style="width: 48px; height: 48px;" onerror="this.parentElement.textContent='ğŸ‰'">`;
                } else {
                    // æ˜¯emojiæˆ–æ™®é€šæ–‡æœ¬
                    iconElement.textContent = iconParam || 'ğŸ†';
                }
                
                popup.querySelector('.achievement-title').textContent = title;
                document.getElementById('achievementDesc').textContent = description;
                
                popup.style.display = 'block';
                popup.style.animation = 'achievementBounce 0.5s ease';
                
                setTimeout(() => {
                    popup.style.opacity = '0';
                    popup.style.transition = 'opacity 0.5s ease';
                    setTimeout(() => {
                        popup.style.display = 'none';
                        popup.style.opacity = '1';
                    }, 500);
                }, 3000);
            }
        }
        
        // åŠ¨ç”»æ•ˆæœ
        const style = document.createElement('style');
        style.textContent = `
            @keyframes achievementBounce {
                0% { transform: translate(-50%, -50%) scale(0); }
                50% { transform: translate(-50%, -50%) scale(1.1); }
                100% { transform: translate(-50%, -50%) scale(1); }
            }
            
            .mode-btn.active {
                background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%) !important;
                color: white !important;
            }
            
            .mode-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(240, 147, 251, 0.4);
            }
            
            #map {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }
            
            .notification {
                position: fixed;
                top: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: white;
                padding: 15px 30px;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 3000;
                animation: slideDown 0.3s ease;
            }
            
            @keyframes slideDown {
                from {
                    top: -100px;
                    opacity: 0;
                }
                to {
                    top: 100px;
                    opacity: 1;
                }
            }
            
            .notification.success {
                border-left: 4px solid #4caf50;
            }
            
            .notification.error {
                border-left: 4px solid #f44336;
            }
            
            .notification.info {
                border-left: 4px solid #2196f3;
            }
            
            .notification.love {
                border-left: 4px solid #f093fb;
                background: linear-gradient(45deg, rgba(240, 147, 251, 0.1) 0%, rgba(245, 87, 108, 0.1) 100%);
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>